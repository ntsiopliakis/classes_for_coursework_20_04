:imagesdir: Images
:figure-caption: Рисунок

== Разработка системы классов в рамках курсовой работы

На рисунке 1 представлена диаграмма классов программы (файл UML.mdj в репозитории).

.Диаграмма классов
image::1.svg[8000 4000]


Класс Measurement, описывающий значения  измеряемых величин, имеет следующие компоненты:

* DataSourceFcn - указатель на функцию-поставщик данных;
* units - массив единиц измерения, используемых для выражения значения этой величины;
* countOfUnit - длина массива unit;
* defaultUnit - исходная единица измерения, в которой выражены значения, поставляемые источником данных DataSourceFcn;
* GetValue() - функция, возвращающая выраженное в defaultUnit значение измеряемой величины;
* GetValue(unit) - функция, возвращающая значение измеряемой величины, выраженное в выбранной единице измерения unit;
* quantityName - сторка наименования измеряемой величины;
* ShowUnitName(unit) - статическая функция, возвращающаяя строку обозначения единицы измерения unit.
* конструктор, создающий экземпляр класса на основе названия измеряемой величины, массива  допустимых единиц измерений, длины этого массива, исходной величины измерения, указателя на функцию-поставщика данных;
* упрощенный конструктор для величин с одной допустимой единицей измерения, создающий экземпляр класса на основе названия измеряемой величины, единицы измерения, указателя на функцию-поставщика данных.

Дочерний класс Temperature, реализующий логику пересчета из одной температурной шкалы в другую, используется для описания величин, имеющих размерность температуры: temperature и dewPoint. Давление и влажность в рамках данной программы имеют по одной единице измерения, и ввиду отсутствия специальной логики для их описания достаточно базового класса.

Классы USART, UsartDriver, SPI, SpiDriver используются для передачи данных по протоколам USART и SPI соответственно.

Класс bme280 используется для взаимодействия с датчиком BME280:

* Функция StartMeasurements() запускает измерения датчика с передискретизацией 1, устонавливает режим работы normal.
* Функция InitializeCalibrateData() считывает калибровочные коэффициенты.
* Функция Measure() обновляет поля temperature, pressure, humidity, dewPoint в соответствии с возвращаемыми значениями функций ReadTemperature(), ReadPressure(), ReadHumidity(), CalcDewPoint().

Класс EPDDriver используется для взаимодействия с дисплеем (пока ничего не работает, взаимодействие отсутствует).
Пробовал воспроизводить функционал из https://github.com/waveshare/e-Paper/blob/master/STM32/STM32-F103ZET6/User/e-Paper/EPD_4in2.c[WaveShare EPD Github].

Часть программы, связанная с классом measurement, датчиком bme280, spi и usart функционирует корректно. Файлы проекта прилагаются.

Вывод измеренных значений температуры, давления, влажности, и рассчитанного значения точки росы в программу Terminal.exe:

.Вывод измерений в Terminal.exe
image::2.png[8000 4000]